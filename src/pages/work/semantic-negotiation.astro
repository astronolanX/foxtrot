---
import Base from "../../layouts/Base.astro";
import Diagram from "../../components/Diagram.astro";
import CodeTabs from "../../components/CodeTabs.astro";
import ComponentDemo from "../../components/ComponentDemo.astro";
---

<Base title="Semantic Negotiation Layer · Nolan">
  <div class="project">
    <!-- Grain overlay -->
    <div class="grain" aria-hidden="true"></div>

    <!-- Back link -->
    <nav class="back">
      <a href="/" class="back-link">← back</a>
    </nav>

    <!-- Hero -->
    <header class="hero">
      <div class="wip-badge">Work in Progress</div>
      <span class="hero-tag">theory</span>
      <h1 class="hero-title">Semantic Negotiation Layer</h1>
      <p class="hero-meta">Design Systems Infrastructure</p>
    </header>

    <!-- Content -->
    <main class="content">
      <section class="intro">
        <p class="lead">
          What if components could explain their constraints to AI agents—and negotiate
          alternatives when those constraints are violated?
        </p>
      </section>

      <Diagram
        caption="Agent-component negotiation flow"
        definition={`flowchart LR
    A[Agent] -->|request| B[Component]
    B --> C{Valid?}
    C -->|yes| D[Render]
    C -->|no| E[Alternatives]
    E -->|options| A`}
      />

      <section class="body">
        <h2>The Problem</h2>
        <p>
          AI agents generating UI code don't understand <em>why</em> a button has specific
          padding or why a card enforces maximum content length. They pattern-match from
          examples, missing the semantic intent behind design decisions.
        </p>
        <p>
          The result: syntactically correct code that violates design system principles.
          A button with a 200-character label. A card nested inside another card. Spacing
          that "looks right" but breaks the underlying system.
        </p>

        <h2>The Proposal</h2>
        <p>
          Components expose a machine-readable negotiation interface—not just props, but
          constraint rationales. When an agent requests something invalid, the component
          responds with alternatives rather than silent failure.
        </p>

        <div class="callout">
          <p>Agent: "Button with label 'Submit your application for review and approval'"</p>
          <p>Component: "Label exceeds 40 characters. Options: truncate, wrap, or use a different pattern."</p>
        </div>

        <p>
          The agent negotiates with the component rather than blindly overriding. Constraints
          become collaborative, not adversarial.
        </p>

        <ComponentDemo
          variant="button-truncation"
          caption="Constraint resolution: label truncated to fit mobile layout"
        />

        <CodeTabs
          tabs={[
            { label: "Request", code: `agent.request({
  component: "Button",
  props: { label: "Submit your application for review and approval" }
})`, caption: "Agent requests a Button with a 52-character label" },
            { label: "Constraint", code: `component.constraint({
  violated: "label.maxLength",
  limit: 40,
  actual: 52,
  rationale: "Labels over 40 chars break mobile layout"
})`, caption: "Component explains the violation and its rationale" },
            { label: "Alternatives", code: `component.alternatives([
  { action: "truncate", result: "Submit your application..." },
  { action: "wrap", result: "Multi-line button" },
  { action: "split", result: "Use secondary action pattern" }
])`, caption: "Component offers valid options to resolve the constraint" },
            { label: "Resolution", code: `agent.select("truncate")
// Component renders with truncated label`, caption: "Agent selects an option; component renders accordingly" }
          ]}
        />

        <h2>Why Now</h2>
        <p>
          LLMs excel at natural language reasoning but struggle with implicit constraint
          satisfaction. As agentic development scales, the cost of design system violations
          grows exponentially. MCP (Model Context Protocol) provides structure but not
          semantic intent—53% of organizations remain paralyzed by AI integration uncertainty.
        </p>
        <p>
          Structured negotiation beats post-hoc linting. Prevention over correction.
        </p>

        <h2>Prior Art</h2>
        <p>
          TypeScript's type negotiation. GraphQL schema introspection. Apple's SF Symbols
          with built-in rendering constraints. Zod schema validation with custom error
          messages. The pattern exists—it hasn't been applied to design systems.
        </p>
      </section>

      <figure class="media wide">
        <svg viewBox="0 0 600 240" class="constraint-model" aria-labelledby="constraint-model-title">
          <title id="constraint-model-title">Constraint communication model layers</title>
          <!-- Layer 3: Negotiation Interface -->
          <g class="layer" data-layer="negotiation">
            <rect x="50" y="160" width="500" height="60" fill="#ebe6dc" stroke="#1a1a1a" stroke-width="1"/>
            <text x="300" y="195" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="14" fill="#1a1a1a">Negotiation Interface</text>
          </g>
          <!-- Layer 2: Constraint Rationales -->
          <g class="layer" data-layer="constraints">
            <rect x="50" y="85" width="500" height="60" fill="#ebe6dc" stroke="#1a1a1a" stroke-width="1"/>
            <text x="300" y="115" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="14" fill="#1a1a1a">Constraint Rationales</text>
            <text x="300" y="135" text-anchor="middle" font-family="DM Sans, sans-serif" font-size="11" fill="#8a8a8a">(why limits exist)</text>
          </g>
          <!-- Layer 1: Component API (existing) -->
          <g class="layer" data-layer="api">
            <rect x="50" y="10" width="500" height="60" fill="#f4f1eb" stroke="#1a1a1a" stroke-width="1"/>
            <text x="300" y="40" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="14" fill="#1a1a1a">Component API</text>
            <text x="300" y="58" text-anchor="middle" font-family="DM Sans, sans-serif" font-size="11" fill="#8a8a8a">(what exists today)</text>
          </g>
          <!-- Annotation arrows -->
          <line x1="570" y1="40" x2="590" y2="40" stroke="#8a8a8a" stroke-width="1"/>
          <text x="595" y="44" font-family="JetBrains Mono, monospace" font-size="10" fill="#8a8a8a">existing</text>
          <line x1="570" y1="115" x2="590" y2="115" stroke="#1a1a1a" stroke-width="1"/>
          <text x="595" y="119" font-family="JetBrains Mono, monospace" font-size="10" fill="#1a1a1a">new</text>
        </svg>
        <figcaption>Semantic enrichment layers on top of traditional component props</figcaption>
      </figure>

      <section class="details">
        <div class="detail">
          <span class="detail-label">Domain</span>
          <span class="detail-value">Agent-Component Interfaces</span>
        </div>
        <div class="detail">
          <span class="detail-label">Status</span>
          <span class="detail-value">Theoretical Proposal</span>
        </div>
        <div class="detail">
          <span class="detail-label">Dependencies</span>
          <span class="detail-value">MCP, Structured Schemas</span>
        </div>
      </section>
    </main>

    <!-- Next project -->
    <footer class="next">
      <a href="/work/agent-credentialing" class="next-link">
        <span class="next-label">Next</span>
        <span class="next-title">Agent Credentialing System</span>
      </a>
    </footer>
  </div>
</Base>

<style>
  .project {
    position: relative;
    min-height: 100vh;
    background: var(--color-paper);
    color: var(--color-ink);
  }

  .grain {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 1000;
    opacity: 0.04;
    mix-blend-mode: multiply;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  }

  .back {
    position: fixed;
    top: 2rem;
    left: 2rem;
    z-index: 100;
  }

  .back-link {
    font-family: var(--font-display);
    font-size: var(--font-size-sm);
    color: var(--color-ink-muted);
    transition: color 0.2s ease;
  }

  .back-link:hover {
    color: var(--color-paper);
    background: var(--color-ink);
    padding: 0.2em 0.4em;
    margin: -0.2em -0.4em;
  }

  .hero {
    padding: 8rem 2rem 4rem;
    max-width: 48rem;
    margin: 0 auto;
  }

  .wip-badge {
    font-family: var(--font-display);
    font-size: var(--font-size-sm);
    color: var(--color-paper);
    background: var(--color-ink);
    padding: 0.25em 0.6em;
    display: inline-block;
    margin-bottom: 1.5rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  .hero-tag {
    font-family: var(--font-display);
    font-size: var(--font-size-sm);
    color: var(--color-ink-muted);
    display: block;
    margin-bottom: 1rem;
    text-transform: lowercase;
  }

  .hero-title {
    font-family: var(--font-display);
    font-size: clamp(2rem, 5vw, 3rem);
    font-weight: 400;
    line-height: 1.1;
    margin-bottom: 1rem;
    color: var(--color-ink);
  }

  .hero-meta {
    font-family: var(--font-body);
    font-size: var(--font-size-sm);
    color: var(--color-ink-muted);
  }

  .content {
    max-width: 48rem;
    margin: 0 auto;
    padding: 0 2rem 4rem;
  }

  .intro {
    margin-bottom: 3rem;
  }

  .lead {
    font-size: var(--font-size-lg);
    line-height: 1.5;
    color: var(--color-ink-secondary);
  }

  .body h2 {
    font-family: var(--font-display);
    font-size: var(--font-size-base);
    font-weight: 400;
    margin: 3rem 0 1rem;
    text-transform: lowercase;
    letter-spacing: 0.05em;
    color: var(--color-ink);
  }

  .body p {
    margin-bottom: 1rem;
    color: var(--color-ink-secondary);
    line-height: 1.7;
  }

  .body em {
    font-style: italic;
  }

  .callout {
    border-left: 2px solid var(--color-ink);
    padding-left: 1.5rem;
    margin: 2rem 0;
  }

  .callout p {
    font-family: var(--font-display);
    font-size: var(--font-size-sm);
    color: var(--color-ink);
    font-style: normal;
    margin: 0.5rem 0;
  }

  .callout p:first-child {
    margin-top: 0;
  }

  .callout p:last-child {
    margin-bottom: 0;
  }

  .media {
    margin: 3rem 0;
  }

  .media.wide {
    margin: 3rem -2rem;
    max-width: calc(100% + 4rem);
  }

  .media-placeholder {
    aspect-ratio: 16/9;
    background: var(--color-paper-warm);
    border: 1px solid rgba(0,0,0,0.08);
    border-radius: 0.25rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .media-placeholder span {
    font-family: var(--font-display);
    font-size: var(--font-size-sm);
    color: var(--color-ink-muted);
  }

  .constraint-model {
    width: 100%;
    max-width: 600px;
    height: auto;
  }

  .constraint-model .layer rect {
    transition: fill 0.2s ease, stroke-width 0.2s ease;
  }

  .constraint-model .layer:hover rect {
    fill: var(--color-paper);
    stroke-width: 2px;
  }

  .media figcaption {
    font-family: var(--font-display);
    font-size: var(--font-size-sm);
    color: var(--color-ink-muted);
    text-align: center;
    margin-top: 1rem;
  }

  .details {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
    margin-top: 4rem;
    padding-top: 2rem;
    border-top: 1px solid rgba(0,0,0,0.1);
  }

  .detail-label {
    font-family: var(--font-display);
    font-size: var(--font-size-sm);
    color: var(--color-ink-muted);
    display: block;
    margin-bottom: 0.5rem;
  }

  .detail-value {
    font-family: var(--font-body);
    font-size: var(--font-size-sm);
    color: var(--color-ink);
  }

  .next {
    background: var(--color-paper-warm);
    border-top: 1px solid rgba(0,0,0,0.05);
    padding: 4rem 2rem;
  }

  .next-link {
    display: block;
    max-width: 48rem;
    margin: 0 auto;
    color: var(--color-ink);
    transition: all 0.2s ease;
  }

  .next-link:hover {
    opacity: 1;
  }

  .next-link:hover .next-title {
    background: var(--color-ink);
    color: var(--color-paper);
    padding: 0.15em 0.35em;
    margin: -0.15em -0.35em;
  }

  .next-label {
    font-family: var(--font-display);
    font-size: var(--font-size-sm);
    color: var(--color-ink-muted);
    display: block;
    margin-bottom: 0.5rem;
  }

  .next-title {
    font-family: var(--font-display);
    font-size: var(--font-size-xl);
    color: var(--color-ink);
    transition: all 0.2s ease;
  }

  .back-link:focus-visible,
  .next-link:focus-visible {
    outline: 2px solid var(--color-ink);
    outline-offset: 4px;
  }

  .back-link:active {
    opacity: 0.5;
  }

  .next-link:active {
    opacity: 0.4;
  }

  @media (max-width: 768px) {
    .hero {
      padding: 6rem 1.5rem 3rem;
    }

    .content {
      padding: 0 1.5rem 3rem;
    }

    .back {
      left: 1.5rem;
      top: 1.5rem;
    }

    .next {
      padding: 3rem 1.5rem;
    }
  }

  @media (max-width: 640px) {
    .back {
      position: relative;
      top: auto;
      left: auto;
      padding: 1.5rem;
    }

    .back-link {
      padding: 0.5rem;
      margin: -0.5rem;
    }

    .hero {
      padding: 1rem 1.5rem 2rem;
    }

    .hero-title {
      font-size: 1.75rem;
    }

    .content {
      padding: 0 1.5rem 2rem;
    }

    .lead {
      font-size: var(--font-size-base);
    }

    .details {
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .media.wide {
      margin: 2rem -1.5rem;
      max-width: calc(100% + 3rem);
    }

    .next {
      padding: 2rem 1.5rem;
    }

    .next-link {
      padding: 1rem;
      margin: -1rem;
    }

    .next-title {
      font-size: var(--font-size-lg);
    }
  }

  @media (max-width: 380px) {
    .hero-title {
      font-size: 1.5rem;
    }

    .body h2 {
      font-size: var(--font-size-sm);
    }
  }
</style>

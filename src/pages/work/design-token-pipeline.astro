---
import Base from "../../layouts/Base.astro";
---

<Base title="Design Token Pipeline ¬∑ Nolan">
  <div class="project">
    <!-- Grain overlay -->
    <div class="grain" aria-hidden="true"></div>

    <!-- Back link -->
    <nav class="back">
      <a href="/" class="back-link">&larr; back</a>
    </nav>

    <!-- Hero -->
    <header class="hero">
      <span class="hero-tag">demo</span>
      <h1 class="hero-title">Design Token Pipeline</h1>
      <p class="hero-meta">Design Systems ¬∑ 2024</p>
    </header>

    <!-- Content -->
    <main class="content">
      <section class="intro">
        <p class="lead">
          Maintaining design-code parity with AI
        </p>
        <p class="lead-sub">
          When a designer updates a color in Figma, that change sits in limbo‚Äî
          waiting for someone to notice, copy values, and hope nothing breaks.
          This demo shows a different path.
        </p>
      </section>

      <section class="body">
        <h2>The Problem</h2>
        <p>
          Design systems promise consistency. Reality delivers drift. Tokens get
          updated in Figma but not in code. Developers hardcode values "just to ship."
          Nobody knows if a change will break accessibility until it's in production.
        </p>
        <p>
          The tools exist to sync tokens automatically‚ÄîTokens Studio, Style Dictionary,
          GitHub Actions. But they only solve half the problem. They sync values.
          They don't think about consequences.
        </p>

        <div class="callout">
          <p>Syncing tokens without analyzing impact is automation without intelligence.</p>
        </div>
      </section>

      <section class="body">
        <h2>The Solution</h2>
        <p>
          An AI-orchestrated pipeline that doesn't just sync‚Äîit analyzes. Built on
          the industry-standard stack (Figma MCP, Style Dictionary, W3C design tokens),
          but with two capabilities that change everything:
        </p>
      </section>

      <!-- Architecture diagram -->
      <figure class="media wide">
        <div class="architecture">
          <div class="arch-row">
            <div class="arch-node figma">
              <span class="arch-label">Figma</span>
              <span class="arch-detail">Variables</span>
            </div>
            <div class="arch-arrow">&rarr;</div>
            <div class="arch-node claude">
              <span class="arch-label">Claude Code</span>
              <span class="arch-detail">MCP Read</span>
            </div>
            <div class="arch-arrow">&rarr;</div>
            <div class="arch-node code">
              <span class="arch-label">Codebase</span>
              <span class="arch-detail">global.css</span>
            </div>
          </div>
          <div class="arch-features">
            <div class="arch-feature">
              <span class="arch-feature-icon">üîç</span>
              <span class="arch-feature-label">Drift Detection</span>
            </div>
            <div class="arch-feature">
              <span class="arch-feature-icon">‚ö°</span>
              <span class="arch-feature-label">Impact Analysis</span>
            </div>
            <div class="arch-feature">
              <span class="arch-feature-icon">üîÑ</span>
              <span class="arch-feature-label">Style Dictionary</span>
            </div>
          </div>
        </div>
        <figcaption>The pipeline: read, analyze, transform, ship.</figcaption>
      </figure>

      <section class="body">
        <h2>Drift Detection</h2>
        <p>
          Before syncing new values, the pipeline scans your codebase for hardcoded
          values that should already be tokens. It finds the <code>#a0a0a0</code> that
          should be <code>var(--color-text-secondary)</code>. It calculates a "parity
          score" so you know exactly how aligned your code is with your design system.
        </p>
      </section>

      <figure class="media">
        <div class="code-block">
          <div class="code-header">
            <span class="code-title">Drift Report</span>
          </div>
          <pre class="code-content"><code>Found 4 hardcoded values that should be tokens:

src/components/Nav.astro:12
‚îÇ color: #a0a0a0
‚îî‚Üí Use: var(--color-text-secondary)

src/pages/index.astro:45
‚îÇ padding-block: 88px
‚îî‚Üí Use: var(--space-section-md)

Parity score: 87%</code></pre>
        </div>
        <figcaption>Drift detection finds debt before it compounds.</figcaption>
      </figure>

      <section class="body">
        <h2>Impact Analysis</h2>
        <p>
          Changing a color token isn't just about the new value. It's about
          every place that color appears. The pipeline traces all usages and runs
          WCAG contrast checks against their backgrounds. You see accessibility
          failures before the PR is created, not after launch.
        </p>
      </section>

      <figure class="media">
        <div class="code-block">
          <div class="code-header">
            <span class="code-title">Impact Analysis</span>
          </div>
          <pre class="code-content"><code>TOKEN: --color-accent
CHANGE: #e5e5e5 ‚Üí #ff6b35

‚ö†Ô∏è  WCAG FAILURES (2)

src/components/Button.astro:15
‚îÇ Text on accent background
‚îÇ Contrast: 2.8:1 (needs 4.5:1)
‚îî‚Üí Suggestion: darken accent or lighten text

‚úì SAFE USAGES (3)
‚Ä¢ CursorGlow.astro ‚Äî decorative glow
‚Ä¢ index.astro ‚Äî border accent</code></pre>
        </div>
        <figcaption>Impact analysis catches accessibility issues before they ship.</figcaption>
      </figure>

      <section class="body">
        <h2>What Makes This Different</h2>
        <p>
          Most token pipelines are dumb pipes. Values go in, values come out.
          This pipeline understands context. It knows the difference between a
          color used for text (where contrast matters) and a color used for a
          decorative glow (where it doesn't).
        </p>
        <p>
          The simulated PR doesn't just show what changed. It shows what those
          changes mean. Reviewers see WCAG compliance status, affected components,
          and the parity score‚Äîall the context needed to make an informed decision.
        </p>
      </section>

      <!-- Stats -->
      <section class="stats">
        <div class="stat">
          <span class="stat-value">87%</span>
          <span class="stat-label">parity score</span>
        </div>
        <div class="stat">
          <span class="stat-value">WCAG 2.1</span>
          <span class="stat-label">contrast analysis</span>
        </div>
        <div class="stat">
          <span class="stat-value">W3C DTCG</span>
          <span class="stat-label">token format</span>
        </div>
      </section>

      <section class="body">
        <h2>Try the Demo</h2>
        <p>
          This isn't a concept. It's running on this site. The tokens you're
          looking at right now can be synced from Figma through this pipeline.
          The drift detection scans this actual codebase. The impact analysis
          checks these actual components.
        </p>
      </section>

      <!-- Demo CTA -->
      <section class="demo-cta">
        <div class="demo-box">
          <span class="demo-icon">üéØ</span>
          <h3 class="demo-title">Interactive Demo</h3>
          <p class="demo-desc">
            Watch Claude read tokens from Figma, detect drift in this codebase,
            analyze accessibility impact, and generate a PR‚Äîall orchestrated
            through a single command.
          </p>
          <a href="https://github.com/nolansym/foxtrot/blob/main/tokens/README.md" class="demo-link">
            View Demo Instructions &rarr;
          </a>
        </div>
      </section>

      <section class="body">
        <h2>Technical Stack</h2>
        <p>
          Built on proven technology, extended with intelligent analysis:
        </p>
        <ul class="tech-list">
          <li><strong>Figma MCP</strong> ‚Äî Read tokens via Model Context Protocol</li>
          <li><strong>Style Dictionary</strong> ‚Äî Transform to W3C DTCG format</li>
          <li><strong>Tailwind CSS 4</strong> ‚Äî Output as @theme CSS custom properties</li>
          <li><strong>Custom drift detection</strong> ‚Äî AST scanning for hardcoded values</li>
          <li><strong>WCAG contrast engine</strong> ‚Äî Automated accessibility checking</li>
          <li><strong>Claude Code skill</strong> ‚Äî Orchestration via /design-token-demo</li>
        </ul>
      </section>

      <section class="details">
        <div class="detail">
          <span class="detail-label">Type</span>
          <span class="detail-value">Design Systems Tooling</span>
        </div>
        <div class="detail">
          <span class="detail-label">Year</span>
          <span class="detail-value">2024</span>
        </div>
        <div class="detail">
          <span class="detail-label">Stack</span>
          <span class="detail-value">Node.js, Style Dictionary, Figma MCP</span>
        </div>
      </section>
    </main>

    <!-- Next project -->
    <footer class="next">
      <a href="/work/onboarding-digitization" class="next-link">
        <span class="next-label">Next</span>
        <span class="next-title">Onboarding Digitization</span>
      </a>
    </footer>
  </div>
</Base>

<style>
  .project {
    position: relative;
    min-height: 100vh;
    background: var(--color-paper);
    color: var(--color-ink);
  }

  .grain {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 1000;
    opacity: 0.04;
    mix-blend-mode: multiply;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  }

  .back {
    position: fixed;
    top: 2rem;
    left: 2rem;
    z-index: 100;
  }

  .back-link {
    font-family: var(--font-display);
    font-size: var(--font-size-sm);
    color: var(--color-ink-muted);
    transition: all 0.2s ease;
  }

  .back-link:hover {
    color: var(--color-paper);
    background: var(--color-ink);
    padding: 0.2em 0.4em;
    margin: -0.2em -0.4em;
  }

  .hero {
    padding: 8rem 2rem 4rem;
    max-width: 48rem;
    margin: 0 auto;
  }

  .hero-tag {
    font-family: var(--font-display);
    font-size: var(--font-size-sm);
    color: var(--color-ink-muted);
    display: block;
    margin-bottom: 1rem;
    text-transform: lowercase;
  }

  .hero-title {
    font-family: var(--font-display);
    font-size: clamp(2rem, 5vw, 3rem);
    font-weight: 400;
    line-height: 1.1;
    margin-bottom: 1rem;
    color: var(--color-ink);
  }

  .hero-meta {
    font-family: var(--font-body);
    font-size: var(--font-size-sm);
    color: var(--color-ink-muted);
  }

  .content {
    max-width: 48rem;
    margin: 0 auto;
    padding: 0 2rem 4rem;
  }

  .intro {
    margin-bottom: 3rem;
  }

  .lead {
    font-family: var(--font-display);
    font-size: var(--font-size-xl);
    line-height: 1.3;
    color: var(--color-ink);
    margin-bottom: 1.5rem;
  }

  .lead-sub {
    font-size: var(--font-size-lg);
    line-height: 1.5;
    color: var(--color-ink-secondary);
  }

  .body h2 {
    font-family: var(--font-display);
    font-size: var(--font-size-base);
    font-weight: 400;
    margin: 3rem 0 1rem;
    text-transform: lowercase;
    letter-spacing: 0.05em;
    color: var(--color-ink);
  }

  .body h2:first-child {
    margin-top: 0;
  }

  .body p {
    margin-bottom: 1rem;
    color: var(--color-ink-secondary);
    line-height: 1.7;
  }

  .body code {
    font-family: var(--font-display);
    font-size: 0.9em;
    background: rgba(0,0,0,0.05);
    padding: 0.1em 0.3em;
    border-radius: 0.2em;
  }

  .callout {
    border-left: 2px solid var(--color-ink);
    padding-left: 1.5rem;
    margin: 2rem 0;
  }

  .callout p {
    font-family: var(--font-display);
    font-size: var(--font-size-base);
    color: var(--color-ink);
    font-style: normal;
    margin: 0;
  }

  .media {
    margin: 3rem 0;
  }

  .media.wide {
    margin: 3rem -4rem;
    max-width: calc(100% + 8rem);
  }

  .media figcaption {
    font-family: var(--font-display);
    font-size: var(--font-size-sm);
    color: var(--color-ink-muted);
    margin-top: 0.75rem;
    text-align: center;
  }

  /* Architecture diagram */
  .architecture {
    background: var(--color-paper-warm);
    border-radius: 0.5rem;
    padding: 2rem;
    border: 1px solid rgba(0,0,0,0.08);
  }

  .arch-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .arch-node {
    background: white;
    border: 1px solid rgba(0,0,0,0.1);
    border-radius: 0.5rem;
    padding: 1rem 1.5rem;
    text-align: center;
    min-width: 120px;
  }

  .arch-node.claude {
    background: var(--color-ink);
    color: var(--color-paper);
    border-color: var(--color-ink);
  }

  .arch-label {
    font-family: var(--font-display);
    font-size: var(--font-size-sm);
    display: block;
    font-weight: 500;
  }

  .arch-detail {
    font-family: var(--font-body);
    font-size: var(--font-size-sm);
    opacity: 0.7;
    display: block;
    margin-top: 0.25rem;
  }

  .arch-arrow {
    font-size: 1.5rem;
    color: var(--color-ink-muted);
  }

  .arch-features {
    display: flex;
    justify-content: center;
    gap: 2rem;
  }

  .arch-feature {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-family: var(--font-display);
    font-size: var(--font-size-sm);
    color: var(--color-ink-secondary);
  }

  /* Code blocks */
  .code-block {
    background: var(--color-ink);
    border-radius: 0.5rem;
    overflow: hidden;
  }

  .code-header {
    background: rgba(255,255,255,0.1);
    padding: 0.75rem 1rem;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }

  .code-title {
    font-family: var(--font-display);
    font-size: var(--font-size-sm);
    color: var(--color-paper);
    opacity: 0.7;
  }

  .code-content {
    padding: 1rem;
    margin: 0;
    overflow-x: auto;
  }

  .code-content code {
    font-family: var(--font-display);
    font-size: var(--font-size-sm);
    color: var(--color-paper);
    background: none;
    padding: 0;
    line-height: 1.6;
  }

  /* Demo CTA */
  .demo-cta {
    margin: 3rem 0;
  }

  .demo-box {
    background: var(--color-paper-warm);
    border: 1px solid rgba(0,0,0,0.08);
    border-radius: 0.5rem;
    padding: 2rem;
    text-align: center;
  }

  .demo-icon {
    font-size: 2rem;
    display: block;
    margin-bottom: 1rem;
  }

  .demo-title {
    font-family: var(--font-display);
    font-size: var(--font-size-lg);
    color: var(--color-ink);
    margin-bottom: 0.75rem;
  }

  .demo-desc {
    font-size: var(--font-size-base);
    color: var(--color-ink-secondary);
    margin-bottom: 1.5rem;
    max-width: 32rem;
    margin-inline: auto;
  }

  .demo-link {
    font-family: var(--font-display);
    font-size: var(--font-size-base);
    color: var(--color-ink);
    text-decoration: underline;
    text-underline-offset: 0.2em;
  }

  .demo-link:hover {
    background: var(--color-ink);
    color: var(--color-paper);
    text-decoration: none;
    padding: 0.2em 0.5em;
    margin: -0.2em -0.5em;
    border-radius: 0.2em;
  }

  /* Tech list */
  .tech-list {
    margin: 1.5rem 0;
    padding: 0;
    list-style: none;
  }

  .tech-list li {
    margin-bottom: 0.75rem;
    padding-left: 1.5rem;
    position: relative;
    color: var(--color-ink-secondary);
    line-height: 1.6;
  }

  .tech-list li::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0.6em;
    width: 0.5rem;
    height: 1px;
    background: var(--color-ink-muted);
  }

  .tech-list strong {
    color: var(--color-ink);
    font-weight: 400;
  }

  .stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
    margin: 4rem 0;
    padding: 2rem 0;
    border-top: 1px solid rgba(0,0,0,0.1);
    border-bottom: 1px solid rgba(0,0,0,0.1);
  }

  .stat {
    text-align: center;
  }

  .stat-value {
    font-family: var(--font-display);
    font-size: var(--font-size-xl);
    color: var(--color-ink);
    display: block;
    margin-bottom: 0.5rem;
  }

  .stat-label {
    font-family: var(--font-body);
    font-size: var(--font-size-sm);
    color: var(--color-ink-muted);
  }

  .details {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
    margin-top: 2rem;
  }

  .detail-label {
    font-family: var(--font-display);
    font-size: var(--font-size-sm);
    color: var(--color-ink-muted);
    display: block;
    margin-bottom: 0.5rem;
  }

  .detail-value {
    font-family: var(--font-body);
    font-size: var(--font-size-sm);
    color: var(--color-ink);
  }

  .next {
    background: var(--color-paper-warm);
    border-top: 1px solid rgba(0,0,0,0.05);
    padding: 4rem 2rem;
  }

  .next-link {
    display: block;
    max-width: 48rem;
    margin: 0 auto;
    color: var(--color-ink);
    transition: all 0.2s ease;
  }

  .next-link:hover .next-title {
    background: var(--color-ink);
    color: var(--color-paper);
    padding: 0.15em 0.35em;
    margin: -0.15em -0.35em;
  }

  .next-label {
    font-family: var(--font-display);
    font-size: var(--font-size-sm);
    color: var(--color-ink-muted);
    display: block;
    margin-bottom: 0.5rem;
  }

  .next-title {
    font-family: var(--font-display);
    font-size: var(--font-size-xl);
    color: var(--color-ink);
    transition: all 0.2s ease;
  }

  @media (max-width: 768px) {
    .hero {
      padding: 6rem 1.5rem 3rem;
    }

    .content {
      padding: 0 1.5rem 3rem;
    }

    .back {
      left: 1.5rem;
      top: 1.5rem;
    }

    .next {
      padding: 3rem 1.5rem;
    }

    .stats {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    .media.wide {
      margin: 2rem -1.5rem;
      max-width: calc(100% + 3rem);
    }

    .arch-row {
      flex-direction: column;
    }

    .arch-arrow {
      transform: rotate(90deg);
    }

    .arch-features {
      flex-direction: column;
      gap: 1rem;
    }

    .details {
      grid-template-columns: 1fr;
      gap: 1rem;
    }
  }

  @media (max-width: 640px) {
    .back {
      position: relative;
      top: auto;
      left: auto;
      padding: 1.5rem;
    }

    .hero {
      padding: 1rem 1.5rem 2rem;
    }

    .hero-title {
      font-size: 1.75rem;
    }

    .content {
      padding: 0 1.5rem 2rem;
    }

    .lead {
      font-size: var(--font-size-lg);
    }

    .lead-sub {
      font-size: var(--font-size-base);
    }

    .demo-box {
      padding: 1.5rem;
    }
  }
</style>
